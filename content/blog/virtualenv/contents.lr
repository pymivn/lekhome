title:

Äá»«ng sudo, náº¿u khÃ´ng biáº¿t virtualenv
---
author: HVN
---
pub_date: 2017-07-06
---
shortintro: Náº¿u báº¡n gÃµ `sudo pip` Ä‘á»ƒ cÃ i Python package, cÃ³ thá»ƒ báº¡n Ä‘Ã£ sai
---
body:

- "MÃ¬nh khÃ´ng cÃ i báº±ng pip Ä‘Æ°á»£c..."
- "cháº¡y sudo pip ... nhÃ© "

ÄÃ³ lÃ  nhá»¯ng cÃ¢u há»i vÃ  tráº£ lá»i thÆ°á»ng xuáº¥t hiá»‡n, khi ngÆ°á»i ta nÃ³i vá» pip. ÄÃ¢y lÃ  váº¥n Ä‘á» chung vá»›i nhá»¯ng ngÆ°á»i dÃ¹ng khÃ´ng hiá»ƒu vá» phÃ¢n quyá»n trÃªn UNIX vÃ  thÆ°á»ng sáº½ lÃ m má»i thá»© trá»Ÿ nÃªn ráº¯c rá»‘i thÃªm báº±ng cÃ¡ch cháº¡y sudo.

## sudo - cÃ¢u lá»‡nh tháº§n thÃ¡nh

![Sudo XKCD](https://imgs.xkcd.com/comics/sandwich.png)

Má»™t máº©u truyá»‡n nhá» cho tháº¥y sá»©c máº¡nh cá»§a `sudo`, khi ta nÃ³i mÃ  Ä‘á»‘i phÆ°Æ¡ng khÃ´ng nghe, thÃªm `sudo` vÃ o Ä‘áº§u lÃ  má»i thá»© Ä‘á»u sáº½ hoáº¡t Ä‘á»™ng.

### sudo - SUperuser DO
TrÃªn cÃ¡c há»‡ Ä‘iá»u hÃ nh *NIX cÃ³ chia ra nhiá»u user Ä‘á»ƒ nhiá»u ngÆ°á»i  dÃ¹ng chung má»™t mÃ¡y tÃ­nh. Trong Ä‘Ã³, má»i mÃ¡y tÃ­nh luÃ´n cÃ³ user `root` - user cÃ³ quyá»n nÄƒng tá»‘i thÆ°á»£ng, thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  quyá»n admin hay superuser, cÃ³ thá»ƒ thá»±c hiá»‡n báº¥t ká»³ thay Ä‘á»•i gÃ¬ trÃªn mÃ¡y tÃ­nh. Do cÃ³ quyá»n nÄƒng vÃ´ háº¡n nhÆ° váº­y, nÃªn khi thá»±c hiá»‡n viá»‡c gÃ¬ cÅ©ng áº©n chá»©a nguy hiá»ƒm, má»™t cÃ¢u lá»‡nh gÃµ nháº§m cÅ©ng cÃ³ thá»ƒ phÃ¡ huá»· há»‡ thá»‘ng, vÃ  náº¿u nhÆ° ai cÅ©ng lÃ  root thÃ¬ há»‡ thá»‘ng sáº½ loáº¡n, ngÆ°á»i dÃ¹ng khÃ´ng hiá»ƒu biáº¿t cÃ³ thá»ƒ cÃ i Ä‘áº·t cÃ¡c loáº¡i virus/malware lÃªn mÃ¡y tÃ­nh (hi Windows).

Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á»n nÃ y, ngÆ°á»i ta sáº£n xuáº¥t ra pháº§n má»m tÃªn "sudo", cho phÃ©p cáº¥p quyá»n cho cÃ¡c user nháº¥t Ä‘á»‹nh. Vá»›i sá»± tá»“n táº¡i cá»§a sudo, ngÆ°á»i ta thay Ä‘á»•i cÃ¡ch dÃ¹ng mÃ¡y tÃ­nh:
- táº¥t cáº£ má»i ngÆ°á»i Ä‘á»u cÃ³ tÃ i khoáº£n riÃªng cá»§a mÃ¬nh
- cáº¥p quyá»n `root` cho má»™t sá»‘ user cá»¥ thá»ƒ
- user Ä‘Æ°á»£c cáº¥p quyá»n cÃ³ thá»ƒ cháº¡y cÃ¢u lá»‡nh nhÆ° user root.

### Khi nÃ o cáº§n quyá»n root
Má»—i user trÃªn *NIX Ä‘Æ°á»£c cáº¥p má»™t thÆ° má»¥c gá»i lÃ  thÆ° má»¥c HOME. CÃ³ thá»ƒ truy cáº­p thÆ° má»¥c nÃ y báº±ng:

```bash
cd ~
```

hay
```bash
cd $HOME
```

ThÆ° má»¥c nÃ y thÆ°á»ng cÃ³ Ä‘Æ°á»ng dáº«n `/home/yourname/`.
vÃ  máº·c Ä‘á»‹nh thuá»™c toÃ n quyá»n sá»­ dá»¥ng cá»§a user <yourname>, thÃ­ch táº¡o/sá»­a/xoÃ¡ file nÃ o thÃ¬ tuá»³ Ã½.

Há»‡ thá»‘ng cÃ³ thÆ° má»¥c Ä‘áº·c biá»‡t `/tmp`, ai cÅ©ng Ä‘á»u cÃ³ thá»ƒ ghi vÃ o (nhÆ°ng ngÆ°á»i nÃ y khÃ´ng thá»ƒ can thiá»‡p vÃ o file/thÆ° má»¥c cá»§a ngÆ°á»i kia) - vÃ  cÃ¡c file trong nÃ y sáº½ tá»± bá»‹ xoÃ¡ má»—i khi mÃ¡y táº¯t.

CÃ²n láº¡i, cÃ¡c thÆ° má»¥c khÃ¡c trÃªn mÃ¡y tÃ­nh chá»‰ cÃ³ `root` má»›i cÃ³ thá»ƒ thay Ä‘á»•i (/etc, /log, /var, /usr, /bin ...), khi sá»­ dá»¥ng cÃ¡c pháº§n má»m thá»±c hiá»‡n thay Ä‘á»•i áº£nh hÆ°á»Ÿng Ä‘áº¿n cáº£ há»‡ thá»‘ng, vÃ­ dá»¥ dÃ¹ng `apt-get` Ä‘á»ƒ cÃ i package, lÃ½ do ta cáº§n cháº¡y sudo vÃ¬:
- apt-get sáº½ ghi file vÃ o cÃ¡c thÆ° má»¥c nÃ³i trÃªn. VÃ­ dá»¥ khi cÃ i package `nginx`, cÃ¡c file sau sáº½ Ä‘Æ°á»£c táº¡o ra:

```sh
$ dpkg -L nginx | grep nginx
/var/cache/nginx
/var/log/nginx
/usr/lib/nginx
/usr/lib/nginx/modules
/usr/share/doc/nginx
/usr/share/doc/nginx/CHANGES.ru.gz
/usr/share/doc/nginx/changelog.Debian.gz
/usr/share/doc/nginx/changelog.gz
/usr/share/doc/nginx/copyright
/usr/share/doc/nginx/README
/usr/share/man/man8/nginx.8.gz
/usr/share/lintian/overrides/nginx
/usr/share/nginx
/usr/share/nginx/html
/usr/share/nginx/html/index.html
/usr/share/nginx/html/50x.html
/usr/sbin/nginx-debug
/usr/sbin/nginx
/etc/init.d/nginx-debug
/etc/init.d/nginx
/etc/logrotate.d/nginx
/etc/nginx
/etc/nginx/koi-win
/etc/nginx/fastcgi_params
/etc/nginx/uwsgi_params
/etc/nginx/mime.types
/etc/nginx/koi-utf
/etc/nginx/nginx.conf
/etc/nginx/conf.d
/etc/nginx/conf.d/default.conf
/etc/nginx/scgi_params
/etc/nginx/win-utf
/etc/default/nginx-debug
/etc/default/nginx
/etc/nginx/modules
...
```

Chá»‰ user `root` má»›i cÃ³ quyá»n ghi vÃ o /etc/ /bin ... Ä‘Ã³ lÃ  lÃ½ do cáº§n thÃªm `sudo` khi ngÆ°á»i dÃ¹ng vá»›i user cá»§a há» cháº¡y cÃ¢u lá»‡nh `apt-get`.

Náº¿u ta cáº¥u hÃ¬nh cho `apt-get` khÃ´ng ghi vÃ o cÃ¡c thÆ° má»¥c trÃªn, ta hoÃ n toÃ n cÃ³ thá»ƒ cháº¡y `apt-get` Ä‘á»ƒ cÃ i Ä‘áº·t package trÃªn thÆ° má»¥c home cá»§a mÃ¬nh. CÃ¡c chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c cÃ i xong sáº½ chá»‰ mÃ¬nh mÃ¬nh dÃ¹ng Ä‘Æ°á»£c, do user khÃ¡c khÃ´ng truy cáº­p Ä‘Æ°á»£c vÃ o cÃ¡c file nÃ y.

### sudo pip

Khi dÃ¹ng pip cÃ i ipython (khÃ´ng dÃ¹ng virtualenv), Ä‘Ã¢y lÃ  nÆ¡i ipython sáº½ Ä‘Æ°á»£c cÃ i:

```
root@hvn:~# pip show ipython
Name: ipython
Version: 6.1.0
Summary: IPython: Productive Interactive Computing
Home-page: https://ipython.org
Author: The IPython Development Team
Author-email: ipython-dev@python.org
License: BSD
Location: /usr/local/lib/python3.5/dist-packages
Requires: prompt-toolkit, setuptools, pygments, simplegeneric, jedi, pexpect, traitlets, pickleshare, decorator
```

`/usr/local` lÃ  thÆ° má»¥c chá»‰ `root` má»›i Ä‘Æ°á»£c quyá»n ghi, vÃ¬ váº­y báº¡n khÃ´ng thá»ƒ cháº¡y `pip install PACKAGE`, bá»Ÿi user thÃ´ng thÆ°á»ng khÃ´ng cÃ³ quyá»n (permission denied) ghi vÃ o /usr

```sh
$ pip install phg
..,
PermissionError: [Errno 13] Permission denied: '/usr/local/lib/python3.5/dist-packages/phg-1.1.0.dist-info'
```

MÃ´-tuÃ½p truyá»n thá»‘ng láº¡i xáº£y ra:
- "MÃ¬nh khÃ´ng cÃ i Ä‘Æ°á»£c ..."
- "sudo pip ..."

CÃ¡ch lÃ m nÃ y khÃ´ng sai, nhÆ°ng thiáº¿u hiá»ƒu biáº¿t:
- nÃ³ cÃ i Ä‘áº·t package lÃªn thÆ° má»¥c há»‡ thá»‘ng /usr/local/lib, khi cÃ³ nhu cáº§u sá»­ dá»¥ng 2 phiÃªn báº£n cá»§a cÃ¹ng 1 pháº§n má»m, ta khÃ´ng thá»ƒ gá»¡ má»™t báº£n Ä‘i vÃ  giá»¯ láº¡i báº£n kia (VD: django 1.7 vÃ  django 1.11)
- khÃ´ng pháº£i code nÃ o cÃ i tá»« pip cÅ©ng an toÃ n, khi cháº¡y vá»›i user root cÃ i má»™t package chá»©a code phÃ¡ hoáº¡i, nÃ³ cÃ³ thá»ƒ huá»· diá»‡t cáº£ há»‡ thá»‘ng (vÃ¬ user root cÃ³ quyá»n lÃ m má»i thá»©).

Giáº£i phÃ¡p lÃ  virtualenv!

## Virtualenv
virtualenv lÃ  má»™t pháº§n má»m viáº¿t báº±ng Python, giÃºp táº¡o ra cÃ¡c "mÃ´i trÆ°á»ng áº£o" Ä‘á»ƒ tÃ¡ch biá»‡t cÃ¡c mÃ´i trÆ°á»ng cá»§a cÃ¡c project khÃ¡c nhau.

Má»—i "mÃ´i trÆ°á»ng áº£o" vá» báº£n cháº¥t chá»‰ lÃ  má»™t thÆ° má»¥c, vá»›i má»™t vÃ i thay Ä‘á»•i khiáº¿n cho khi ta dÃ¹ng pip Ä‘á»ƒ cÃ i package, cÃ¡c package sáº½ Ä‘Æ°á»£c cÃ i vÃ o thÆ° má»¥c nÃ y. Äiá»u nÃ y giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» nÃ³i trÃªn:
- tÃ¡ch biá»‡t cÃ¡c mÃ´i trÆ°á»ng giá»¯a cÃ¡c project, 2 project cÃ³ thá»ƒ dÃ¹ng 2 phiÃªn báº£n khÃ¡c nhau cá»§a cÃ¹ng 1 pháº§n má»m.
- ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ táº¡o mÃ´i trÆ°á»ng áº£o trong thÆ° má»¥c $HOME cá»§a mÃ¬nh, khÃ´ng cáº§n cháº¡y sudo - khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n há»‡ thá»‘ng.

virtualenv hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c lÃ  nhá» vÃ o cÃ¡ch mÃ  Python thá»±c hiá»‡n import. [Luáº­t import cá»§a Python](https://docs.python.org/3/tutorial/modules.html#the-module-search-path), khi ta `import spam`:

- TÃ¬m cÃ¡c builtin module xem cÃ³ cÃ¡i nÃ o tÃªn lÃ  spam khÃ´ng. Danh sÃ¡ch cÃ¡c builtin module Ä‘Æ°á»£c chá»©a trong sys:

```sh
 python -c 'import sys; print(sys.builtin_module_names)'
('__builtin__', '__main__', '_ast', '_bisect', '_codecs', '_collections', '_functools', '_heapq', '_io', '_locale', '_md5', '_random', '_sha', '_sha256', '_sha512', '_socket', '_sre', '_struct', '_symtable', '_warnings', '_weakref', 'array', 'binascii', 'cPickle', 'cStringIO', 'cmath', 'datetime', 'errno', 'exceptions', 'fcntl', 'gc', 'grp', 'imp', 'itertools', 'marshal', 'math', 'operator', 'posix', 'pwd', 'select', 'signal', 'spwd', 'strop', 'sys', 'syslog', 'thread', 'time', 'unicodedata', 'xxsubtype', 'zipimport', 'zlib')
```

- Náº¿u khÃ´ng tháº¥y, tÃ¬m láº§n lÆ°á»£t trong cÃ¡c thÆ° má»¥c chá»©a trong list : `sys.path`, cho Ä‘áº¿n khi tÃ¬m tháº¥y file spam.py.
- Náº¿u váº«n khÃ´ng tháº¥y, raise Exception `ImportError`.

Khi ta báº­t (activate) má»™t virtualenv lÃªn (source), thá»±c táº¿ ta thay Ä‘á»•i sys.path, nhÃ©t Ä‘Æ°á»ng dáº«n Ä‘áº¿n "mÃ´i trÆ°á»ng áº£o" hiá»‡n táº¡i lÃªn Ä‘áº§u sys.path, vÃ¬ váº­y khi thá»±c hiá»‡n import, Python sáº½ tÃ¬m trong "mÃ´i trÆ°á»ng áº£o" trÆ°á»›c.

Äá»c ká»¹ nhá»¯ng dÃ²ng sau Ä‘á»ƒ tháº¥y sá»± áº£nh hÆ°á»Ÿng cá»§a virtualenv vá»›i Python sys.path,
khi báº­t virtualenv, Ä‘Æ°á»ng dáº«n tá»›i virtualenv sáº½ xuáº¥t hiá»‡n trong sys.path,
tá»©c module / code nÃ o náº±m trong thÆ° má»¥c
`/home/hvn/myvenv/lib/python3.6/site-packages`
Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c import.

```sh
$ python3 -m venv myvenv
$ source myvenv/bin/activate
(myvenv) $ python3 -c 'import sys; print(sys.path)'
['', '/usr/lib/python36.zip', '/usr/lib/python3.6', '/usr/lib/python3.6/lib-dynload', '/home/hvn/myvenv/lib/python3.6/site-packages']
(myvenv) $ deactivate
$ python3 -c 'import sys; print(sys.path)'
['', '/usr/lib/python36.zip', '/usr/lib/python3.6', '/usr/lib/python3.6/lib-dynload', '/usr/local/lib/python3.6/dist-packages', '/usr/lib/python3/dist-packages']
```

Vá»›i virtualenv, ta sáº½ khÃ´ng bao giá» pháº£i `sudo pip` ná»¯a, má»—i project sáº½ cÃ³ má»™t mÃ´i trÆ°á»ng riÃªng biá»‡t, khÃ´ng ai áº£nh hÆ°á»Ÿng tá»›i ai. VÃ  chá»‰ gÃµ `sudo pip` khi cáº§n thay Ä‘á»•i 1 package trÃªn toÃ n há»‡ thá»‘ng.

### Sá»­ dá»¥ng pip trong venv

Cho python3.6 trá»Ÿ lÃªn, vÃ­ dá»¥ trÃªn Ubuntu 18.04, xem [tÃ i
liá»‡u](https://docs.python.org/3/tutorial/venv.html)
cho lá»‡nh dÃ¹ng trÃªn Windows.

```sh
$ python3 -m venv myvenv
$ source myvenv/bin/activate
(myvenv) $ python3 -m pip install django
Collecting django
  Cache entry deserialization failed, entry ignored
  Downloading https://files.pythonhosted.org/packages/5c/63/6d7efecbf3f06db8c6577950a24a191e55cadf7cda4d7fe6976206c886dd/Django-3.0.7-py3-none-any.whl (7.5MB)
    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7.5MB 206kB/s
Collecting pytz (from django)
  Using cached https://files.pythonhosted.org/packages/4f/a4/879454d49688e2fad93e59d7d4efda580b783c745fd2ec2a3adf87b0808d/pytz-2020.1-py2.py3-none-any.whl
Collecting sqlparse>=0.2.2 (from django)
  Using cached https://files.pythonhosted.org/packages/85/ee/6e821932f413a5c4b76be9c5936e313e4fc626b33f16e027866e1d60f588/sqlparse-0.3.1-py2.py3-none-any.whl
Collecting asgiref~=3.2 (from django)
  Cache entry deserialization failed, entry ignored
  Downloading https://files.pythonhosted.org/packages/68/00/25013f7310a56d17e1ab6fd885d5c1f216b7123b550d295c93f8e29d372a/asgiref-3.2.7-py2.py3-none-any.whl
Installing collected packages: pytz, sqlparse, asgiref, django
Successfully installed asgiref-3.2.7 django-3.0.7 pytz-2020.1 sqlparse-0.3.1
(myvenv) $ python
Python 3.6.9 (default, Apr 18 2020, 01:56:04)
[GCC 8.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import django
>>> django.__version__
'3.0.7'
>>>
```

## Káº¿t luáº­n
`sudo` lÃ  sá»©c máº¡nh, Ä‘á»«ng chá»‰ vÃ¬ quÃ¡ máº¡nh mÃ  thÃ­ch lÃ m gÃ¬ cÅ©ng Ä‘Æ°á»£c ğŸ™„
